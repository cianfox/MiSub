<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å‡ºåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        button {
            background: #4F46E5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #4338CA;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .info {
            background: #EEF2FF;
            border-left: 4px solid #4F46E5;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” MiSub å¯¼å‡ºåŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="info">
            <strong>è¯´æ˜ï¼š</strong>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•å¯¼å‡ºå¤‡ä»½åŠŸèƒ½ï¼Œæ— éœ€ç™»å½•ã€‚
            <br>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•ç»å…¸å¸ƒå±€å’Œæ–°å¸ƒå±€çš„å¯¼å‡ºé€»è¾‘ã€‚
        </div>

        <div>
            <button onclick="testClassicExport()">æµ‹è¯•ç»å…¸å¸ƒå±€å¯¼å‡ºé€»è¾‘</button>
            <button onclick="testNewExport()">æµ‹è¯•æ–°å¸ƒå±€å¯¼å‡ºé€»è¾‘</button>
            <button onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
        </div>

        <div id="output"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿ dataStore æ•°æ®
        const mockDataStore = {
            subscriptions: [
                { id: '1', name: 'æœºåœºè®¢é˜…1', url: 'https://example.com/sub1', enabled: true },
                { id: '2', name: 'æœºåœºè®¢é˜…2', url: 'https://example.com/sub2', enabled: true },
                { id: '3', name: 'æ‰‹åŠ¨èŠ‚ç‚¹1', url: 'ss://xxxxx', enabled: true },
                { id: '4', name: 'æ‰‹åŠ¨èŠ‚ç‚¹2', url: 'vmess://xxxxx', enabled: true },
            ],
            profiles: [
                { id: 'p1', name: 'è®¢é˜…ç»„1', subscriptions: ['1', '3'], enabled: true },
                { id: 'p2', name: 'è®¢é˜…ç»„2', subscriptions: ['2', '4'], enabled: true },
            ]
        };

        function log(message) {
            const output = document.getElementById('output');
            output.textContent += message + '\n';
        }

        function clearOutput() {
            document.getElementById('output').textContent = '';
        }

        function testClassicExport() {
            clearOutput();
            log('=== æµ‹è¯•ç»å…¸å¸ƒå±€å¯¼å‡ºé€»è¾‘ ===\n');
            
            try {
                // ç»å…¸å¸ƒå±€çš„å¯¼å‡ºé€»è¾‘
                const subscriptions = mockDataStore.subscriptions || [];
                const profiles = mockDataStore.profiles || [];
                const manualNodes = subscriptions.filter(item => !item.url || !/^https?:\/\//.test(item.url));
                
                log('1. subscriptions (æ‰€æœ‰é¡¹ç›®): ' + JSON.stringify(subscriptions, null, 2));
                log('\n2. profiles (è®¢é˜…ç»„): ' + JSON.stringify(profiles, null, 2));
                log('\n3. manualNodes (è¿‡æ»¤åçš„æ‰‹åŠ¨èŠ‚ç‚¹): ' + JSON.stringify(manualNodes, null, 2));
                
                const backupData = {
                    subscriptions: subscriptions,
                    manualNodes: manualNodes,
                    profiles: profiles,
                };
                
                log('\n=== æœ€ç»ˆå¯¼å‡ºæ•°æ® ===');
                log(JSON.stringify(backupData, null, 2));
                
                log('\nâœ… ç»å…¸å¸ƒå±€å¯¼å‡ºæµ‹è¯•å®Œæˆ');
                log('subscriptions æ•°é‡: ' + backupData.subscriptions.length);
                log('manualNodes æ•°é‡: ' + backupData.manualNodes.length);
                log('profiles æ•°é‡: ' + backupData.profiles.length);
                
            } catch (error) {
                log('âŒ é”™è¯¯: ' + error.message);
            }
        }

        function testNewExport() {
            clearOutput();
            log('=== æµ‹è¯•æ–°å¸ƒå±€å¯¼å‡ºé€»è¾‘ ===\n');
            
            try {
                // æ–°å¸ƒå±€çš„å¯¼å‡ºé€»è¾‘ï¼ˆä¿®å¤åï¼‰
                const dataStoreSubscriptions = mockDataStore.subscriptions;
                const dataStoreProfiles = mockDataStore.profiles;
                
                log('1. dataStore.subscriptions: ' + JSON.stringify(dataStoreSubscriptions, null, 2));
                log('\n2. dataStore.profiles: ' + JSON.stringify(dataStoreProfiles, null, 2));
                
                const dataStoreManualNodes = dataStoreSubscriptions?.filter(item => !item.url || !/^https?:\/\//.test(item.url)) || [];
                
                log('\n3. è¿‡æ»¤åçš„æ‰‹åŠ¨èŠ‚ç‚¹: ' + JSON.stringify(dataStoreManualNodes, null, 2));
                
                const backupData = {
                    subscriptions: dataStoreSubscriptions || [],
                    manualNodes: dataStoreManualNodes,
                    profiles: dataStoreProfiles || [],
                };
                
                log('\n=== æœ€ç»ˆå¯¼å‡ºæ•°æ® ===');
                log(JSON.stringify(backupData, null, 2));
                
                log('\nâœ… æ–°å¸ƒå±€å¯¼å‡ºæµ‹è¯•å®Œæˆ');
                log('subscriptions æ•°é‡: ' + backupData.subscriptions.length);
                log('manualNodes æ•°é‡: ' + backupData.manualNodes.length);
                log('profiles æ•°é‡: ' + backupData.profiles.length);
                
            } catch (error) {
                log('âŒ é”™è¯¯: ' + error.message);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            log('ğŸ“‹ æµ‹è¯•ç¯å¢ƒå·²å°±ç»ª\n');
            log('æ¨¡æ‹Ÿæ•°æ®ï¼š');
            log('- 2ä¸ªæœºåœºè®¢é˜… (HTTP URL)');
            log('- 2ä¸ªæ‰‹åŠ¨èŠ‚ç‚¹ (SS/VMess)');
            log('- 2ä¸ªè®¢é˜…ç»„\n');
            log('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...\n');
        };
    </script>
</body>
</html>
